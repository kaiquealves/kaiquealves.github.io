<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Jogo de Adivinha√ß√£o de Bandeiras</title>
  <style>
    html, body { height: 100%; margin: 0; font-family: 'Segoe UI', Arial, sans-serif; background: #f5f6fa; color: #222; }
    #root { min-height: 100vh; display: flex; flex-direction: column; }
    .centered-container { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 2rem 1rem; }
    .game-title { font-size: 2.5rem; font-weight: bold; margin-bottom: 1.5rem; color: #2d8cf0; letter-spacing: 1px; text-align: center; }
    .instructions { max-width: 400px; margin-top: 1.5rem; margin-bottom: 2rem; font-size: 1.1rem; color: #555; text-align: center; }
    .start-btn { background-color: #2d8cf0; color: #fff; border: none; border-radius: 6px; padding: 1rem 2.5rem; font-size: 1.3rem; font-weight: bold; cursor: pointer; box-shadow: 0 2px 8px rgba(45,140,240,0.08); transition: background .2s, box-shadow .2s; outline-offset: 2px; }
    .start-btn:hover, .start-btn:focus { background-color: #1766b3; box-shadow: 0 4px 16px rgba(45,140,240,0.15); }
    .flag-img { max-width: 80vw; max-height: 40vh; width: auto; height: auto; border-radius: 12px; box-shadow: 0 2px 12px rgba(0,0,0,0.08); margin-bottom: 2rem; background-color: #eaeaea; }
    .loading-spinner { border: 4px solid #eaeaea; border-top: 4px solid #2d8cf0; border-radius: 50%; width: 48px; height: 48px; animation: spin 1s linear infinite; margin-bottom: 1.5rem; }
    @keyframes spin { to { transform: rotate(360deg); } }
    .error-message { color: #c0392b; font-weight: bold; margin-bottom: 1rem; }
    .retry-btn { background-color: #fff; color: #2d8cf0; border: 2px solid #2d8cf0; border-radius: 6px; padding: .7rem 1.5rem; font-size: 1rem; font-weight: bold; cursor: pointer; margin-top: .5rem; }
    .retry-btn:hover, .retry-btn:focus { background-color: #eaf4ff; }
    @media (max-width:600px) {
      .game-title { font-size: 1.7rem; }
      .instructions { font-size: .98rem; }
    }
  </style>
</head>
<body>
<div id="root"></div>
<!-- React and ReactDOM via CDN -->
<script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
<script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
<script type="text/javascript">
const { useState, useEffect, useRef } = React;

// SPA Router (simple)
function useRoute() {
  const [route, setRoute] = useState(window.location.hash.replace(/^#/, '') || '/');
  useEffect(() => {
    const onHashChange = () => setRoute(window.location.hash.replace(/^#/, '') || '/');
    window.addEventListener('hashchange', onHashChange);
    return () => window.removeEventListener('hashchange', onHashChange);
  }, []);
  const navigate = (to) => { window.location.hash = to; };
  return [route, navigate];
}

// Instructions component
function Instructions() {
  return (
    <div className="instructions" id="instructions">
      Tente adivinhar a qual pa√≠s pertence a bandeira exibida.<br />
      A cada rodada, uma nova bandeira ser√° sorteada.<br />
      Clique em "Come√ßar" para iniciar!
    </div>
  );
}

// HomeScreen component
function HomeScreen({ onStart }) {
  const btnRef = useRef(null);
  useEffect(() => { btnRef.current && btnRef.current.focus(); }, []);
  return (
    <div className="centered-container" role="main">
      <div className="game-title" aria-label="Jogo de Adivinha√ß√£o de Bandeiras">
        <span role="img" aria-label="Bandeira">üè≥Ô∏è‚Äçüåà</span> Adivinhe a Bandeira!
      </div>
      <button
        ref={btnRef}
        className="start-btn"
        aria-label="Come√ßar o jogo"
        tabIndex={0}
        onClick={onStart}
        onKeyDown={e => {
          if (e.key === 'Enter' || e.key === ' ') {
            e.preventDefault();
            onStart();
          }
        }}
        autoFocus
      >
        Come√ßar
      </button>
      <Instructions />
    </div>
  );
}

// GameScreen component
function GameScreen({ usedCountries, onCountryUsed }) {
  const [countries, setCountries] = useState(null);
  const [loading, setLoading] = useState(true);
  const [fetchError, setFetchError] = useState(null);
  const [currentCountry, setCurrentCountry] = useState(null);
  const [imgLoading, setImgLoading] = useState(true);
  const [imgError, setImgError] = useState(false);

  // Fetch countries on mount
  useEffect(() => {
    setLoading(true);
    setFetchError(null);
    fetch('https://restcountries.com/v3.1/all?fields=name,flags')
      .then(res => {
        if (!res.ok) throw new Error('Erro ao buscar pa√≠ses');
        return res.json();
      })
      .then(data => {
        // Filtra pa√≠ses com campos necess√°rios
        const filtered = data.filter(c =>
          c.name && c.name.common && c.flags && (c.flags.png || c.flags.svg)
        );
        setCountries(filtered);
        setLoading(false);
      })
      .catch(err => {
        setFetchError('Erro ao carregar bandeiras. Tentar novamente?');
        setLoading(false);
      });
  }, []);

  // Sorteia pa√≠s n√£o repetido
  function getRandomCountry() {
    if (!countries) return null;
    const unused = countries.filter(c => !usedCountries.includes(c.name.common));
    if (unused.length === 0) return null;
    let idx = Math.floor(Math.random() * unused.length);
    return unused[idx];
  }

  // Ao pa√≠ses carregados ou usedCountries mudar, sorteia novo pa√≠s
  useEffect(() => {
    if (countries && countries.length > 0) {
      const country = getRandomCountry();
      setCurrentCountry(country);
      setImgLoading(true);
      setImgError(false);
      if (country) onCountryUsed(country.name.common);
    }
    // eslint-disable-next-line
  }, [countries]);

  // Retry fetch
  function handleRetry() {
    setCountries(null);
    setLoading(true);
    setFetchError(null);
    setCurrentCountry(null);
    setImgLoading(true);
    setImgError(false);
    fetch('https://restcountries.com/v3.1/all?fields=name,flags')
      .then(res => {
        if (!res.ok) throw new Error('Erro ao buscar pa√≠ses');
        return res.json();
      })
      .then(data => {
        const filtered = data.filter(c =>
          c.name && c.name.common && c.flags && (c.flags.png || c.flags.svg)
        );
        setCountries(filtered);
        setLoading(false);
      })
      .catch(err => {
        setFetchError('Erro ao carregar bandeiras. Tentar novamente?');
        setLoading(false);
      });
  }

  // Retry image
  function handleRetryImg() {
    setImgLoading(true);
    setImgError(false);
    // For√ßa recarregar a imagem trocando a key do elemento img
    setCurrentCountry({ ...currentCountry });
  }

  return (
    <div className="centered-container" role="main">
      <div className="game-title" aria-label="Rodada do Jogo">
        Rodada do Jogo
      </div>
      {loading && (
        <>
          <div className="loading-spinner" role="status" aria-label="Carregando"></div>
          <div>Carregando...</div>
        </>
      )}
      {fetchError && (
        <>
          <div className="error-message">{fetchError}</div>
          <button className="retry-btn" onClick={handleRetry} aria-label="Tentar novamente">Tentar novamente</button>
        </>
      )}
      {!loading && !fetchError && currentCountry && (
        <>
          {!imgError ? (
            <>
              {imgLoading && (
                <>
                  <div className="loading-spinner" role="status" aria-label="Carregando imagem"></div>
                  <div>Carregando bandeira...</div>
                </>
              )}
              <img
                className="flag-img"
                src={currentCountry.flags.png || currentCountry.flags.svg}
                alt="Bandeira de um pa√≠s para adivinhar"
                style={{ display: imgLoading ? 'none' : 'block' }}
                onLoad={() => setImgLoading(false)}
                onError={() => { setImgLoading(false); setImgError(true); }}
              />
            </>
          ) : (
            <>
              <div className="error-message">Imagem n√£o dispon√≠vel.</div>
              <button className="retry-btn" onClick={handleRetryImg} aria-label="Tentar recarregar imagem">Tentar recarregar</button>
            </>
          )}
          {/* Aqui viriam as op√ß√µes de resposta na pr√≥xima hist√≥ria */}
        </>
      )}
      {!loading && !fetchError && !currentCountry && (
        <div className="error-message">Parab√©ns! Voc√™ j√° viu todas as bandeiras dispon√≠veis nesta sess√£o.</div>
      )}
    </div>
  );
}

// App component (SPA)
function App() {
  const [route, navigate] = useRoute();
  // Mant√©m pa√≠ses j√° usados na sess√£o (n√£o persiste em storage)
  const [usedCountries, setUsedCountries] = useState([]);

  function handleStart() {
    // Sempre reinicia o array ao come√ßar novo jogo
    setUsedCountries([]);
    navigate('/game');
  }

  function handleCountryUsed(name) {
    setUsedCountries(prev => prev.includes(name) ? prev : [...prev, name]);
  }

  return (
    <>
      {route === '/' && (
        <HomeScreen onStart={handleStart} />
      )}
      {route === '/game' && (
        <GameScreen usedCountries={usedCountries} onCountryUsed={handleCountryUsed} />
      )}
    </>
  );
}

const root = ReactDOM.createRoot(document.getElementById('root'));
root.render(<App />);
</script>
</body>
</html>
